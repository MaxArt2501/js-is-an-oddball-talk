<p-slide>
  <pre
    class="big self-center"
  ><code class="language-js">const person = new Person()</code><p-fragment class="the-stroke" aria-label="A strike through the text '= new Person()' in the code"
    style="top: calc(.5em + 0lh);left: calc(.667em + 13ch);width: 14ch;"
></p-fragment><p-fragment><code class="language-js">
             = Object.create(anotherPerson);</code></p-fragment></pre>
  <p-notes>Where does this come from? It come from a time when&hellip;</p-notes>
</p-slide>
<p-slide>
  <p-notes
    >&hellip; defining a class in JavaScript meant doing this. It's clunky and awkward, and it doesn't look like a class at all. So, someone decided we'd rather use something
    like&hellip;</p-notes
  >
  <pre class="big self-center"><code class="language-js">function Person(name) {
  this.name = name;
}
Person.prototype = {
  greet() {
    console.log("Hi, I'm " + this.name);
  }
};</code></pre>
</p-slide>
<p-slide>
  <p-notes
    >&hellip; this instead to create objects. That "someone" is Douglas Crockford - the author of "JavaScript: the good parts" - and <code>Object.create</code> has been specified
    to satisfy his personal demand. By the way, he said he doesn't use it anymore.</p-notes
  >
  <pre class="big self-center"><code class="language-js">function createPerson(name) {
  return Object.create({
    greet() {
      console.log("Hi, I'm " + this.name);
    }
  }, {
    name: { value: name }
  });
}</code></pre>
</p-slide>
<p-slide>
  <picture class="self-center flex">
    <source src="img/js-gp.avif" type="image/avif">
    <source src="img/js-gp.webp" type="image/webp">
    <img src="img/js-gp.jpg" alt="Cover of the book 'JavaScript - the good parts' by Douglas Crockford" style="height: 11em">
  </picture>
</p-slide>
<p-slide>
  <p-notes>Anyway, how do we use it? We have an object - a <em>prototype</em> for our new object - and use it to define the methods of our new instance.</p-notes>
  <pre class="big self-center"><code class="language-js">const genericPerson = {
  greet() { ... }
};

const person = Object.create(genericPerson)</code><p-fragment class="the-stroke" aria-label="A strike through the text 'Object.create(genericPerson)' in the code"
    style="top: calc(.5em + 4lh);left: calc(.667em + 15ch);width: 28ch;"
><p-notes>But we also have another way to do the exact same thing!</p-notes></p-fragment><p-fragment><code class="language-js">
               {
                 __proto__: genericPerson,
                 name: 'Sam'
               };</code><p-notes>And it would be way more expressive too&hellip;</p-notes></p-fragment><p-fragment class="highlight" aria-label="A highlighting around '__proto__' in the code" style="top: 6lh; left: 17ch; width: 9ch"><p-notes>
    &hellip; if it wasn't for this specially named property <code>__proto__</code>, which means we cannot use it for a property names unless we use square brackets.
  </p-notes></p-fragment></pre>
</p-slide>
<p-slide class="stack">
  <pre class="big self-center"><code class="language-js">class Person {
  constructor(name) { this.name = name; }
  greet() { ... }
}</code><p-fragment><code class="language-js">
const person = {
  __proto__: Person.prototype,
  name: 'Sam'
};</code></p-fragment><p-fragment><code class="language-js">
person instanceof Person // true</code></p-fragment></pre>
  <p-fragment style="place-self: center; rotate: 10deg; margin-bottom: 2.5em">
    <code class="language-js" style="padding: 0.5em; background: var(--slide-bg); border: 0.1em solid">const person = new Person('sam');</code>
  </p-fragment>
</p-slide>
<p-slide class="row align-center justify-evenly">
  <pre><code class="language-js">// Tab 1
class AuthToken {
  constructor(authData) {
    // Side effects here...
  }
}</code><p-fragment><code class="language-js">
let authToken =
  new AuthToken({ credentials });</code></p-fragment><p-fragment><code class="language-js">
channel.postMessage(authToken);</code></p-fragment></pre>
  <p-fragment>
    <pre><code class="language-js">// Tab 2
channel.addEventListener('message',
  ({ data }) => {
    authToken = {
      __proto__: AuthToken.prototype,
      ...data
    };
  }
);</code></pre>
  </p-fragment>
</p-slide>
<p-slide>
  <pre class="big self-center"><code class="language-js">const proto = {
  answer: 42
};</code></pre>
  <div class="flex self-center">
    <p-fragment>
      <pre class="big"><code class="language-js">const a = {
  __proto__: proto
};</code>
<p-fragment><code class="language-js">a // {}
a.answer // 42</code></p-fragment><p-fragment><div
  class="highlight" aria-label="A highlighting around '{}' in the code" style="top: 3lh; left: 5ch; width: 2ch; color: red"></div><div
  class="highlight" aria-label="A highlighting around '42' in the code" style="top: 4lh; left: 12ch; width: 2ch; color: red"></div></p-fragment></pre>
    </p-fragment>
    <p-fragment>
      <pre class="big"><code class="language-js">const b = {
  ['__proto__']: proto
};</code>
<p-fragment><code class="language-js">b // { __proto__: { &hellip; } }
b.answer // undefined</code></p-fragment><p-fragment><div
  class="highlight" aria-label="A highlighting around '{ __proto__: { ... } }' in the code" style="top: 3lh; left: 5ch; width: 20ch"></div><div
  class="highlight" aria-label="A highlighting around 'undefined' in the code" style="top: 4lh; left: 12ch; width: 9ch"></div></p-fragment></pre>
    </p-fragment>
  </div>
</p-slide>
<p-slide>
  <pre class="big self-center"><code class="language-js">const b = {
  ['__proto__']: { answer: 42 }
};
b.answer // undefined</code></pre>
  <div class="flex self-center">
    <p-fragment>
      <pre class="big"><code class="language-js">const c =
  Object.assign({}, b);
</code><p-fragment><code
  class="language-js">c.answer // 42</code></p-fragment><p-fragment class="highlight" aria-label="A highlighting around '42' in the code" style="top: 2lh; left: 12ch; width: 2ch; color: red"></p-fragment></pre>
    </p-fragment>
    <p-fragment>
      <pre class="big"><code class="language-js">const d = { ...b };
</code><p-fragment><code class="language-js">d // { __proto__: { &hellip; } }
d.answer // undefined</code></p-fragment><p-fragment><div
  class="highlight" aria-label="A highlighting around '{ __proto__: { ... } }' in the code" style="top: 1lh; left: 5ch; width: 20ch"></div><div
  class="highlight" aria-label="A highlighting around 'undefined' in the code" style="top: 2lh; left: 12ch; width: 9ch"></div></p-fragment></pre>
    </p-fragment>
  </div>
</p-slide>
<p-slide>
  <pre class="big self-center"><code class="language-js">const userData = {
  __proto__: </code><p-fragment class="collapsed"><code class="language-js">null</code></p-fragment><code class="language-js">,
  name: 'Alice Bob'
};</code><p-fragment class="highlight" aria-label="A highlighting around '__proto__' in the code" style="top: 1lh; left: 2ch; width: 16ch"></p-fragment><p-fragment><code class="language-js">
userData.hasOwnProperty // undefined</code></p-fragment><p-fragment><code class="language-js">
userData.__proto__ = {};</code></p-fragment><p-fragment><code class="language-js">
userData.hasOwnProperty // undefined</code><p-notes>Why should we have something like that?</p-notes></p-fragment></pre>
</p-slide>
<p-slide>
  <pre class="self-center"><code class="language-js input">{}</code>
<p-fragment><code class="language-js output">{}
    [[Prototype]]: Object
      constructor: Æ’ Object()
      hasOwnProperty: Æ’ hasOwnProperty()
      isPrototypeOf: Æ’ isPrototypeOf()
      propertyIsEnumerable: Æ’ propertyIsEnumerable()
      toLocaleString: Æ’ toLocaleString()
      toString: Æ’ toString()
      valueOf: Æ’ valueOf()
      __proto__: (...)
      get __proto__: Æ’ __proto__()
      set __proto__: Æ’ __proto__()</code></p-fragment><p-fragment class="highlight" aria-label="A highlighting around the accessor of '__proto__' in the code" style="top: 11lh; left: 6ch; width: 28ch; height: 2lh"></p-fragment></pre>
</p-slide>
<p-slide>
  <pre
    class="big self-center"
  ><code class="language-txt">https://my.site.com/app?foo=bar</code><p-fragment
  index="1" class="collapsed">&<code class="language-txt" style="color: #f44">__proto__.role=admin</code></p-fragment><p-fragment
  index="2" class="highlight" aria-label="A highlighting around '__proto__.role' in the code" style="top: 0lh; left: 32ch; width: 14ch; color: yellow"></p-fragment></pre>
  <p-fragment class="self-center"
    ><p-notes>If the user has no defined role (for example, because it's not logged in), the user object might be defined, but its role undefined</p-notes>
    <pre class="big"><code class="language-js">user.role // undefined</code>
<p-fragment index="3"><code class="language-js">
const query = parseQueryString(location.search);</code><p-notes>Imagine a custom-made qeury string parsing function</p-notes></p-fragment>
<p-fragment index="4"><code class="language-js">// ... queryObj['__proto__']['role'] = 'admin'</code><p-notes>That at some point does something like this</p-notes></p-fragment><p-fragment
  index="5" class="highlight" aria-label="A highlighting around 'queryObj['__proto__']' in the code" style="top: 3lh; left: 7ch; width: 21ch; color: red"></p-fragment>

<p-fragment index="6"><code class="language-js">user.role // 'admin' ðŸ˜±</code><p-notes>Even if <code>user</code> has nothing to do with <code>query</code>!
But if you set the prototype of queryObj to null, you'd be fine!</p-notes></p-fragment></pre>
  </p-fragment>
</p-slide>
<p-slide>
  <p-notes>Similar things could happen for JSONs</p-notes>
  <pre class="big self-center"><code class="language-js">{ "__proto__": { "role": "admin" } }</code>

<p-fragment><code class="language-js">const data = JSON.parse(raw);</code></p-fragment>
<p-fragment><code class="language-js">// { __proto__: { role: 'admin' } }</code><p-notes>
  Now <em>this</em> is fine, but if you use this object for something apparently safe&hellip;
</p-notes></p-fragment>

<p-fragment><code class="language-js">const allData = Object.assign({ id: 'abc' }, data);</code><p-notes>Whoops! But please note that using object spreading would have worked</p-notes></p-fragment><p-fragment class="the-stroke" aria-label="A strike through the text 'Object.create(genericPerson)' in the code"
    style="top: calc(.5em + 5lh);left: calc(.667em + 14ch);width: 37ch;"
><p-notes>You might say: I'm good! I don't use <code>Object.assign</code>!</p-notes></p-fragment>
<p-fragment><code class="language-js">              = { id: 'abc', ...data };</code><p-notes>I use spread instead! But maybe you're using TypeScript</p-notes></p-fragment><p-fragment style="position: absolute; rotate: -5deg; top: 4.7lh; left: 12ch; z-index: 1000">
    <code class="language-js" style="padding: 0.5em; background: var(--slide-bg); border: 0.1em solid">Object.assign({ id: 'abc' }, data)</code>
    <p-notes>If you configure it correctly, you'll end up with using it without knowing!</p-notes>
  </p-fragment></pre>
</p-slide>
<p-slide>
  <pre class="big no-clip"><code class="language-js">const person = Object.create(Person.prototype);
person.name = 'Sam';</code>

<p-fragment><code class="language-js">const person = {
  __proto__: Person.prototype,
  name: 'Sam'
};</code><p-notes>But also this method is too weird for you</p-notes></p-fragment>

<p-fragment><code class="language-js">const person = { name: 'Sam' };
Object.setPrototypeOf(person, Person.prototype);</code><p-notes>You can always use this one</p-notes></p-fragment><p-fragment
  class="highlight" aria-label="A highlighting around 'Object.setPrototypeOf' in the code" style="top: 9lh; left: 0ch; width: 21ch"></p-fragment></pre>
</p-slide>
<p-slide class="row justify-evenly align-center">
  <pre class="big"><code class="language-js">const person =
  Object.create(protoPerson);
person.name = 'Sam';</code></pre>
  <p-fragment wtf-level="6"></p-fragment>
  <p-notes>I guess it's official API, but it was conceinved in a weird time for JavaScript, when we had no <code>class</code></p-notes>
</p-slide>
<p-slide class="row justify-evenly align-center">
  <pre class="big"><code class="language-js">const person = {
  __proto__: protoPerson,
  name: 'Sam'
};</code></pre>
  <p-fragment wtf-level="5"></p-fragment>
  <p-notes>It's cooler but it's too weird to have a specially named property for this kind of thing</p-notes>
</p-slide>
<p-slide class="row justify-evenly align-center">
  <pre class="big"><code class="language-js">const person = { name: 'Sam' };
Object.setPrototypeOf(
  person,
  protoPerson
);</code></pre>
  <p-fragment wtf-level="9"></p-fragment>
</p-slide>
